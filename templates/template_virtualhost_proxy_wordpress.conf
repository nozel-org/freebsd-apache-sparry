# apache configuration file generated by sparry
<VirtualHost *:80>
    ServerName <domain_name>
    ServerAlias www.<domain_name>

    # Logging
    ErrorLog "/var/log/httpd-<domain_name>-error.log"
    CustomLog "/var/log/httpd-<domain_name>-access.log" common

    # HTTP Security Headers
    Header always set Strict-Transport-Security: "max-age=31536000; includeSubDomains;"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection: "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Permitted-Cross-Domain-Policies: none
    Header always set Referrer-Policy same-origin
    Header always set Content-Security-Policy "default-src https: data: 'unsafe-inline' 'unsafe-eval'"

    # Rewrite requests to HTTPS
    RewriteEngine on
    RewriteCond %{SERVER_NAME} =<domain_name> [OR]
    RewriteCond %{SERVER_NAME} =www.<domain_name>
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,QSA,R=permanent]
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName <domain_name>
    ServerAlias www.<domain_name>

    # Proxy
    ProxyPreserveHost On
    ProxyPass / http://<domain_name>/
    ProxyPassReverse / http://<domain_name>/

    <Location "/">
        RequestHeader set X-Forwarded-Proto https
        RequestHeader set X-Forwarded-Ssl on
        RequestHeader set X-Url-Scheme https
    </Location>

    # Logging
    ErrorLog "/var/log/httpd-<domain_name>-error.log"
    CustomLog "/var/log/httpd-<domain_name>-access.log" common

    # HTTP Security Headers
    Header always set Strict-Transport-Security: "max-age=31536000; includeSubDomains;"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection: "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Permitted-Cross-Domain-Policies: none
    Header always set Referrer-Policy same-origin
    Header always set Content-Security-Policy "default-src https: data: 'unsafe-inline' 'unsafe-eval'"

    # Let's Encrypt configuration
    SSLCertificateFile /usr/local/etc/letsencrypt/live/<domain_name>/fullchain.pem
    SSLCertificateKeyFile /usr/local/etc/letsencrypt/live/<domain_name>/privkey.pem
    Include /usr/local/etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
